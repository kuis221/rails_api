- if resource.persisted?
  | 
    $('#upload_#{params[:unique_id]}').addClass('complete');
    $('#event-photos-thumbs').prepend('#{j render(partial: 'results/photos/photo', locals: {photo: resource})}')
    if (typeof photoProcessingCheck == 'undefined' || !photoProcessingCheck) {
      photoProcessingCheck = setInterval(function() {
        photos = $('.photo-item[data-processed=false]');
        if ( photos.length > 0 ) {
          $.get('#{processing_status_event_photos_path(format: :js)}',
                { photos: $.map(photos, function(el, index){ return $(el).data('photo-id'); }) }
              );
        } else {
          clearInterval(photoProcessingCheck);
          photoProcessingCheck = false;
        }
      },3000);
    }
- else
  | $('#upload_#{params[:unique_id]}').addClass('failed').find('div.progress').removeClass('active').end().find('.upload-file-error').text('#{j resource.errors.full_messages.to_sentence}');
