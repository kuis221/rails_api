- progress_format ||= 'counter'
- sort_by ||= 'title'

.tasks-progress-bar
table#tasks-list.table.table-striped.table-bordered.table-scrolled
  thead
    tr
      th data-sort="title" Task
      th data-sort="last_activity" Last Activity
      th data-sort="due_at" Due Date
      - if params[:scope] != 'user'
        th data-sort="user_name" Team member
      th data-sort="completed" Completed
      th.actions
  tbody

javascript:

  $('#collection-list-filters').filterBox({
    'includeCalendars': true,
    'includeAutoComplete': true,
    'includeSearchBox': false,
    'autoCompletePath': '#{autocomplete_tasks_path(scope: params[:scope] ,format: :json)}',
    'onChange': function(filterBox){
      tasksTable.tableScroller('reloadData');
    }
  });

  $('.tasks-progress-bar').taskProgressBar({format: '#{progress_format}'})

  var tasksTable = $('table#tasks-list').tableScroller({
    'source': '#{source}',
    'fixedHeader': false,
    'defaultSort': '#{sort_by}',
    'rowValues': function(t){
      scope = "#{params[:scope]}"
      if (scope != 'user'){
        return [t.title, t.last_activity, t.due_at, (t.user? t.user.full_name : ''), $('<div>').html(t.complete_form)]
      } else {
        return [t.title, t.last_activity, t.due_at, $('<div>').html(t.complete_form)]
      }
    },
    'filterBox': '#collection-list-filters',
    'rowId': function(row){
      return 'task_'+row.id;
    },
    'onItemsLoad': function(json){
      $('.tasks-progress-bar').taskProgressBar('values', json.total, json.unassigned, json.assigned, json.completed, json.late)
    },
    'actionButtons': ['editable', 'activable', 'commentable']
  })
