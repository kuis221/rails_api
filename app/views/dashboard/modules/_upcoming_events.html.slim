#upcomming-events-module.details_box
  h3 UPCOMING EVENTS

  .text-right
    #toggle-upcomming-events-view.btn-group
      a.btn.active.list href="#list-view" data-toggle="tab" title="List View"
       i.icon-list
      a.btn.calendar href="#calendar-view" data-toggle="tab" title="Calendar View"
       i.icon-grid
      //a.btn.map href="#map-view" data-toggle="tab" title="Map View"

  .tab-content
    #list-view.tab-pane.active
      #events-list.resource-list
        = render upcoming_events_list

    #calendar-view.tab-pane
      #calendar-canvas

    #map-view.tab-pane
      #map-canvas.google-map

  .text-right
    = link_to events_path, class: 'btn btn-info' do
      = "View All"
      i class="icon-angle-right"

- @events = upcoming_events_list
javascript:
  var upcomingEventsMap = upcommingEventsCalendar = false;
  $('#toggle-upcomming-events-view a').on('shown', function(e){
    $('#toggle-upcomming-events-view a').removeClass('active');
    $(e.target).addClass('active')
    if (e.target.getAttribute('href') == '#map-view'){
      if (!upcomingEventsMap) {
        mapOptions = {
          zoom: 5,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        upcomingEventsMap = new google.maps.Map(document.getElementById('map-canvas'), mapOptions)


        upcomingEventsMap.setOptions({styles: window.MAP_STYLES})
      } else {
        google.maps.event.trigger(upcomingEventsMap, 'resize')
      }
      placeMarkers(upcomingEventsMap, #{render(file: 'events/index', formats: [:json]).html_safe});
    } else if (e.target.getAttribute('href') == '#calendar-view'){
      if (!upcommingEventsCalendar) {
        upcommingEventsCalendar = $('#calendar-canvas').eventsCalendar({
          eventsUrl: "/events/calendar.json?event_status[]=Active",
          day: #{Time.zone.now.day},
          month: #{Time.zone.now.month-1},
          year: #{Time.zone.now.year},
          mode: 'weeks',
          renderMonthDay: function(day) {
            date = (day.getMonth()+1)+'/'+day.getDate()+'/'+day.getFullYear()
            return '<a class="cal-day-link" data-date="'+date+'" href="/events?start_date='+date+'&end_date=">'+day.getDate()+'</a>';
          }
        });
      }
    }
  })
