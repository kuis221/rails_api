.row-fluid.with-details-close-bar
  = resource_details_bar("You are viewing venue details. Click to close.", collection_path)

  .details_box
    - unless resource.latitude.nil?
      #venue-map-canvas.google-map data-latitude="#{resource.latitude}" data-longitude="#{resource.longitude}"
            b= resource.name
            br>/
            = place_address(resource.is_a?(Venue) ? resource.place : resource)

    h2= resource.name

    .row-fluid
      .place-data
        = resource.formatted_address
        br>/
        = resource.formatted_phone_number
        - if resource.website
          .link
            = place_website(resource.website)
        = resource.price_level.times.map{ '$' }.join
        = " "
        = resource.types_without_establishment.map{|type| t("venue_types.#{type}") }.join(', ')
        br>/
        - if resource.place.td_linx_code
          = 'TD Linx Code ' + resource.place.td_linx_code
      - if resource.opening_hours
        .time-data
          = place_opening_hours(resource.opening_hours)
      / .description-data
      /   p Cocktails “made with mixers like Hawaiian Punch and Tang”, beer “served in a brown paper bag” and “junk food” like “deep-fried Twinkies and chili cheese tater tots” conjure up “college days” at this “kitschy” SoMa bar with a “trailer park theme”; it may be “gimmicky” and the “dive bar decor” is a little “rough around the edges”, but most are buttered up by the “super-fun” vibe.º

      // The is info will be displayed on the fixed bar when the window is scolled down to this position
      .details-bar-info
        h3= resource.name
        br>/
        = resource.formatted_address

      - if resource.persisted?
          = link_to '', select_areas_venue_path(resource), remote: true, class: 'add-area-venue icon-plus-sign'
          #venue-areas.row-fluid
            = render partial: 'areas', locals: {areas: resource.place.areas}
.details_box
  - if resource.persisted? && resource.events > 0
    .venue-overall
      .row-fluid
        .span6
          #venue-score
            span= resource.score
            | VENUE SCORE
          #venue-score-narrative
            = venue_score_narrative(resource)

        .span6
          #overall-venue-stats.text-right
            .live-stats
              span= resource.events
              = (resource.events == 1 ? " Event" : " Events")
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_with_delimiter(resource.promo_hours)
              = (resource.promo_hours == 1 ? " Promo Hour" : " Promo Hours")
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_with_delimiter(resource.impressions)
              = (resource.impressions == 1 ? " Impression" : " Impressions")
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_with_delimiter(resource.interactions)
              = " Influenced"
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_with_delimiter(resource.sampled)
              = " Sampled"
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
            .live-stats-2
              span= number_with_delimiter(resource.avg_impressions.round)
              = " Impressions/Event"
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_with_delimiter(resource.avg_impressions_hour.round)
              = " Impressions/Promo Hour"
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"
              br>/
              span= number_to_currency(resource.avg_impressions_cost, precision: 2)
              = " Cost/Impression"
              span.sparkline data-sparkline="bar" data-values="0,#{30.times.map{ 3 + Random.rand(6) }.join(',')}"


  - if resource.persisted?
    .row-fluid
      .span6
        #gender-graph.row-fluid
          .span4.male
            .percent
              = "#{resource.overall_graphs_data[:gender].try(:[],'Male').try(:round) || 0} %"
            .gender MALE
          .span4.female
            .percent
              = "#{resource.overall_graphs_data[:gender].try(:[],'Female').try(:round) || 0} %"
            .gender FEMALE
        .row-fluid
          #overall-age-graph
      .span6
        #overall-ethnicity-graph

.details_box
  h3 TRENDS BY DAY OF WEEK
  #venue-trends-by-day-narrative= venue_trend_week_day_narrative(resource)
  #trends-day-week-graph

.details_box
  h3 GALLERY
  .large-photo-list
    ul.thumbnails#photos-list
      - resource.photos.each do |photo|
        - if photo.is_a?(AttachedAsset)
          = render partial: 'results/photos/photo', locals: {photo: photo}
        - else
          li.span2.google-image
            div.thumbnail-container.thumbnail
              a.fancybox data-fancybox-type='image' href="https://maps.googleapis.com/maps/api/place/photo?maxheight=700&maxwidth=700&photoreference=#{photo[:photo_reference]}&sensor=true&key=#{GOOGLE_API_KEY}" rel='photo-gallery'
                = image_tag "https://maps.googleapis.com/maps/api/place/photo?maxwidth=180&photoreference=#{photo[:photo_reference]}&sensor=true&key=#{GOOGLE_API_KEY}"

.details_box
  h3 COMMENTS
  - resource.reviews.each do |review|
    .venue-review
      - unless review.is_a?(Comment)
        .review-author-name= review.author_name
        .review-rating= rating_stars(review.rating)
        .review-date= time_ago_in_words(DateTime.strptime(review.time.to_s,'%s'))
        .review-text= review.text
      - else
        .review-author-name= review.user_full_name
        .review-date= time_ago_in_words(review.created_at)
        .review-text= review.content

javascript:
  $(document).ready(function() {
    $(this).scrollTop(400);
  });

- if resource.persisted?
  javascript:
    $('#overall-age-graph').highcharts({
        chart: { type: 'bar' },
        title: { text: null },
        colors: ['#DFDFDF','#3E9CCF'],
        xAxis: {
            categories: #{resource.overall_graphs_data[:age].keys.to_json.html_safe},
            title: {
                enabled: false
            },
            labels: {
              style: {color: '#3E9CCF', fontSize: '13px'}
            },
            tickLength: 0,
            lineWidth: 0
        },
        tooltip: {enabled: false},
        yAxis: {
            max: 100,
            labels: { enabled: false },
            title: {text: false},
            gridLineColor: 'transparent',
            enabled: false
        },
        plotOptions: {
            bar: {
                dataLabels: {
                    enabled: false
                }
            },
            series: {
                stacking: 'percent',
                enableMouseTracking: false,
                pointPadding: 0,
                groupPadding: 0,
                borderWidth: 0,
                pointPadding: 0,
                pointWidth: 15,
                dataLabels: {
                    color: '#3E9CCF',
                    style: { fontSize: '11px' }
                }
            }
        },
        legend: { enabled: false },
        credits: { enabled: false },
        series: [{
            name: 'Fill in',
            data: #{resource.overall_graphs_data[:age].values.map{|v|(100-v).round}.to_json.html_safe},

        },{
            name: 'Values',
            data: #{resource.overall_graphs_data[:age].values.map(&:round).to_json.html_safe},
            dataLabels: {
                    enabled: true,
                    format: '{y}%',
                    color: '#3E9CCF',
                    align: 'right',
                    x: 30,
                    y: -2,
                    style: { color: '#3E9CCF' }
                }

        }]
    });

    $('#trends-day-week-graph').highcharts({
        credits: { enabled: false },
        chart: {marginTop: 50 },
        title: {
            text: null
        },
        xAxis: {
            categories: ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'],
            lineColor: '#D1D1D1',
            tickWidth: 0,
            labels: {
              style: {
                color: '#D1D1D1'
              }
            },
        },
        yAxis: {
            title: {
                text: null
            },
            gridLineColor: 'transparent',
            lineWidth: 1,
            lineColor: '#D1D1D1',
            tickWidth: 1,
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }],
            labels: {
              style: {
                color: '#D1D1D1'
              }
            },
            min: 0,
            maxPadding: 0.2
        },
        plotOptions: {
            series: {
                marker: {
                    fillColor: '#FFFFFF',
                    lineWidth: 2,
                    lineColor: null, // inherit from series
                    radius: 6
                }
            }
        },
        tooltip: { enabled: false },
        legend: {
            floating: true,
            borderWidth: 0,
            y: -10,
            align: 'right',
            verticalAlign: 'top',
            itemStyle: { fontSize: '10px', color: '#3E9CCF' }
        },
        series: [{
            name: 'Impressions/promo hour',
            data: #{resource.overall_graphs_data[:trends_week_day].values.map(&:round).to_json.html_safe},
            color: '#3D9CCA',
            dataLabels: {
                enabled: true,
                color: '#3E9CCF',
                y: -20,
                style: { color: '#3E9CCF', fontSize: '14px' }
            }
        }]
    });

    if (#{resource.overall_graphs_data[:ethnicity].values.max} > 0) {
        $('#overall-ethnicity-graph').highcharts({
              colors: ['#218ebf', '#3d9bce', '#6ebde7', '#94d6ed'],
              chart: {
                  type: 'pie'
              },
              title: { text: null },
              credits: { enabled: false },
              yAxis: {
                  title: { text: null }
              },
              plotOptions: {
                  pie: {
                      shadow: false
                  },
                  series: {
                    enableMouseTracking: false,
                    dataLabels: {
                      connectorColor: '#C0C0C0',
                      softConnector: false
                    }
                  }
              },
              tooltip: {
                  enabled: false
              },
              series: [{
                  name: 'Ethnicity',
                  data: #{resource.overall_graphs_data[:ethnicity].select{|k,v| v > 0 }.map{|k,v|[k.upcase, v.round]}.to_json.html_safe},
                  size: '60%',
                  innerSize: '30%',
                  distance: -10,
                  dataLabels: {
                      crop: false,
                      formatter: function() {
                          // display only if larger than 1
                          return '<span style="font-size:16px;">'+ this.y +'%' +'</span><br /><div style="width: 50px;font-size:11px;">'+ this.point.name+'</div>';
                      },
                      color: '#3E9CCF',
                  }
              }]
        });
    }

    $(document).on('areas:change', function(){
      $.get('#{areas_venue_path(resource, format: :js)}');
    });
